%h1 Listing Analyzers

%p
  = link_to 'New Analyzer', new_analyzer_path

%p= paginate @analyzers

%table
  %tr
    %th Name
    %th CTW    
    %th Start date
    %th End date
    %th Total
    %th Price @Start
    %th Price @End
    %th
    %th

  - @analyzers.each do |analyzer|
    - ctw = Ctw.find(analyzer.ctw_id)
    %tr
      %td= analyzer.name
      %td= link_to "#{ctw.name}", ctw_path(ctw)
      %td= analyzer.start_date
      %td= analyzer.end_date
      - unless analyzer.actions.empty?
        %td
          %b
            = number_with_delimiter(analyzer.total)
        %td= Value.where(['quote_id = ? and timestamp >= ?', ctw.quote_id, analyzer.actions.first.timestamp]).order("timestamp ASC").first.value
        %td= Value.where(['quote_id = ? and timestamp >= ?', ctw.quote_id, analyzer.actions.last.timestamp]).order("timestamp ASC").first.value
        %td= link_to 'Show', analyzer_actions_path(analyzer)
      %td
        = link_to 'Edit', edit_analyzer_path(analyzer)
        |
        = link_to 'Destroy', analyzer, :confirm => 'Are you sure?', :method => :delete

%br
%p= paginate @analyzers

